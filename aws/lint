#!/bin/bash

TFLINT_CONFIG="/Users/lynda/Desktop/repo/aline-repo-files/dev-infra-cc/aws/.tflint.hcl"
echo "runnung linter"
find modules environments \
  -type f \
  -name '*.tf' \
  ! -path '*/.terraform/*' \
  -exec dirname {} \; \
  | sort -u \
  | xargs -I {} sh -c '
      cp "$2" "$1/.tflint.hcl"
      cd "$1"
      tflint
      terraform fmt -check
      rm .tflint.hcl
      echo "====== $1 processed ======"
    ' sh {} "$TFLINT_CONFIG"
